<div visibilityObserver (visible)="recalculate()">
  <div role="table">
    @if (footerHeight && topPaging) {
    <datatable-footer
      [rowCount]="groupedRows !== undefined ? _internalRows.length : rowCount"
      [pageSize]="pageSize"
      [offset]="offset"
      [footerHeight]="footerHeight"
      [footerTemplate]="footer"
      [totalMessage]="messages.totalMessage"
      [pagerLeftArrowIcon]="cssClasses.pagerLeftArrow"
      [pagerRightArrowIcon]="cssClasses.pagerRightArrow"
      [pagerPreviousIcon]="cssClasses.pagerPrevious"
      [selectedCount]="selected.length"
      [selectedMessage]="!!selectionType && messages.selectedMessage"
      [pagerNextIcon]="cssClasses.pagerNext"
      [pageSizeSelector]="pageSizeSelector"
      [pageSizeOptions]="pageSizeOptions"
      (page)="onFooterPage($event)"
      (size)="recalculatePageSize($event)"
    >
    </datatable-footer>
    } @if (headerHeight) {
    <datatable-header
      role="rowgroup"
      [sorts]="sorts"
      [sortType]="sortType"
      [scrollbarH]="scrollbarH"
      [innerWidth]="_innerWidth"
      [offsetX]="_offsetX | async"
      [dealsWithGroup]="groupedRows !== undefined"
      [columns]="visibleColumns"
      [headerHeight]="headerHeight"
      [reorderable]="reorderable"
      [targetMarkerTemplate]="targetMarkerTemplate"
      [sortAscendingIcon]="cssClasses.sortAscending"
      [sortDescendingIcon]="cssClasses.sortDescending"
      [sortUnsetIcon]="cssClasses.sortUnset"
      [allRowsSelected]="allRowsSelected"
      [selectionType]="selectionType"
      [verticalScrollVisible]="verticalScrollVisible"
      [enableClearingSortState]="enableClearingSortState"
      (sort)="onColumnSort($event)"
      (resize)="onColumnResize($event)"
      (resizing)="onColumnResizing($event)"
      (reorder)="onColumnReorder($event)"
      (select)="onHeaderSelect()"
      (columnContextmenu)="onColumnContextmenu($event)"
    >
    </datatable-header>
    }
    <datatable-body
      tabindex="0"
      role="rowgroup"
      [groupRowsBy]="groupRowsBy"
      [groupedRows]="groupedRows"
      [rows]="_internalRows"
      [groupExpansionDefault]="groupExpansionDefault"
      [scrollbarV]="scrollbarV"
      [scrollbarH]="scrollbarH"
      [virtualization]="virtualization"
      [loadingIndicator]="loadingIndicator"
      [ghostLoadingIndicator]="ghostLoadingIndicator"
      [externalPaging]="externalPaging"
      [rowHeight]="rowHeight"
      [rowCount]="rowCount"
      [offset]="offset"
      [trackByProp]="trackByProp"
      [columns]="visibleColumns"
      [hiddenColumns]="hiddenCol"
      [pageSize]="pageSize"
      [offsetX]="_offsetX | async"
      [rowDetail]="rowDetail"
      [groupHeader]="groupHeader"
      [selected]="selected"
      [innerWidth]="_innerWidth"
      [bodyHeight]="bodyHeight"
      [selectionType]="selectionType"
      [rowIdentity]="rowIdentity"
      [rowClass]="rowClass"
      [selectCheck]="selectCheck"
      [displayCheck]="displayCheck"
      [summaryRow]="summaryRow"
      [summaryHeight]="summaryHeight"
      [summaryPosition]="summaryPosition"
      [verticalScrollVisible]="verticalScrollVisible"
      (page)="onBodyPage($event)"
      (activate)="activate.emit($event)"
      (rowContextmenu)="onRowContextmenu($event)"
      (select)="onBodySelect($event)"
      (scroll)="onBodyScroll($event)"
      (treeAction)="onTreeAction($event)"
      [disableRowCheck]="disableRowCheck"
      [rowDraggable]="rowDraggable"
      [rowDragEvents]="rowDragEvents"
      [rowDefTemplate]="rowDefTemplate"
    >
      <ng-content select="[loading-indicator]" ngProjectAs="[loading-indicator]">
        <datatable-progress></datatable-progress>
      </ng-content>
      <ng-content select="[empty-content]" ngProjectAs="[empty-content]">
        <div class="empty-row" [innerHTML]="messages.emptyMessage"></div>
      </ng-content>
    </datatable-body>
  </div>
  @if (footerHeight && bottomPaging) {
  <datatable-footer
    [rowCount]="groupedRows !== undefined ? _internalRows.length : rowCount"
    [pageSize]="pageSize"
    [offset]="offset"
    [footerHeight]="footerHeight"
    [footerTemplate]="footer"
    [totalMessage]="messages.totalMessage"
    [pagerLeftArrowIcon]="cssClasses.pagerLeftArrow"
    [pagerRightArrowIcon]="cssClasses.pagerRightArrow"
    [pagerPreviousIcon]="cssClasses.pagerPrevious"
    [selectedCount]="selected.length"
    [selectedMessage]="!!selectionType && messages.selectedMessage"
    [pagerNextIcon]="cssClasses.pagerNext"
    [pageSizeSelector]="pageSizeSelector"
    [pageSizeOptions]="pageSizeOptions"
    (page)="onFooterPage($event)"
  >
  </datatable-footer>
  }
</div>
